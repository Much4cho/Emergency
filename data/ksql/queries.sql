CREATE STREAM TEMPERATURES (ID INTEGER, TEMPERATURE DOUBLE) WITH (KAFKA_TOPIC='test', KEY_FORMAT='KAFKA', VALUE_FORMAT='JSON');

CREATE TABLE OUTPUT_TEMPERATURES WITH (KAFKA_TOPIC='output_temperatures', PARTITIONS=1, REPLICAS=1) AS SELECT
  TEMPERATURES.ID ID,
  (SUM(TEMPERATURES.TEMPERATURE) / COUNT(*)) AVG
FROM TEMPERATURES TEMPERATURES
GROUP BY TEMPERATURES.ID
HAVING (COUNT(*) = 1000)
EMIT CHANGES;